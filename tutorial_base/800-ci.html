<!DOCTYPE html>
<html lang="en" ng-app="jpm">

	<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="/css/style.css" rel="stylesheet" />
<title>Continuous Integration</title>


</head>


<body>

	<ul class="container12 menu-bar">
	<li span=10><a class=menu-link href="/"><img class=menu-logo
			src='/img/EnRouteIcon_CMYK.png'></a> <a
		href="/book/100-introduction.html">Guide </a><a
		href="/book/400-services.html">Services </a><a
		href="/book/700-links.html">Links </a><a
		href="/forum.html">Forum</a>
	<li class=menu-link span=1>
	<li class=menu-link span=1><a style="display:block;float:right;margin-right:0px;" href=http://www.osgi.org">OSGi</a></div>
	
</ul>


					

	<ul class=container12>
		<li span=3>
			<div>
			<ul class="side-nav">
	
		
			<li><a href="/book/100-introduction.html">Guide</a>
	  	
  	
		
			<li><a href="/book/200-quick-start.html">Quick Start Tutorial</a>
	  	
  	
		
			<li><a href="/book/210-overview.html">Overview</a>
	  	
  	
		
			<li><a href="/book/215-sos.html">Building Service Oriented Systems</a>
	  	
  	
		
			<li><a href="/book/220-tutorial-base.html">Base Tutorial</a>
	  	
  	
		
			<li><a href="/book/300-principles.html">Principles</a>
	  	
  	
		
			<li><a href="/book/400-services.html">Service Catalog</a>
	  	
  	
		
			<li><a href="/book/700-links.html">Where to Find Stuff</a>
	  	
  	
</ul>

			</div>
			
		<li span=9>
			<div>
				<a class=nav-prev href="700-deploy.html" >Prev</a>
				<a class=nav-next href="/book/220-tutorial-base.html#End" >Next</a> 
				<br/>
				<hr/>
				<h1> Continuous Integration</h1>
				<div class=tutorial-content>
				<h2 id="what-you-will-learn-in-this-section">What You Will Learn in This Section</h2>

<p>In this section we will first see how our current bnd workspace has built in build support through Gradle. Though this can be useful for some local work, the primary purpose is to do continuous integration. So we push the project to Github and set up a Travis Continuous Integration server.</p>

<h2 id="building-outside-the-ide">Building Outside the IDE</h2>

<p>If you can’t automatically build your product then you’re not a software engineer! One of the giant steps of software engineering was when we came from the cave of releasing code from our personal machines and moved into the world of continuous integration. It is amazing how many unwanted dependencies creep un when you build on a personal system. Automating repeated processes is at the heart of building software. It is therefore that OSGi enRoute (well, bnd) includes a full gradle build that does not require any extra work, you’re basically already setup. The <em>raison d’être</em> of bnd is that it runs inside an IDE like Eclipse but can also run from a shell. Great care has been taken to ensure that bnd builds virtual identical artifacts inside the IDE and from the command line. </p>

<p>So we only have to fire up a shell and run the build!</p>

<p>You do not even need to have gradle installed. There is a script included, <code>gradlew</code>, that will download the correct gradle version. You can also install gradle (&gt;= 1.12) and use it. It should go without saying, but you should also have java 8 installed on the command line.</p>

<pre class="shell"><code>$ cd /Ws/com.acme.prime
$ java -version
java version "1.8.0"
Java(TM) SE Runtime Environment ...
$ ./gradlew
Downloading https://b../biz.aQute.bnd-latest.jar to 
    /Ws/com.acme.prime/cnf/cache/biz.aQute.bnd-latest.jar ...
:help

Welcome to Gradle 1.12.
To run a build, run gradlew &lt;task&gt; ...
To see a list of available tasks, run gradlew tasks
To see a list of command-line options, run gradlew --help
BUILD SUCCESSFUL
</code></pre>

<p>For almost all features of bndtools there is a corresponding gradle task you can execute. You can see all the possible tasks with <code>./gradlew tasks</code>. For example, you automatically get a task to build your <code>com.acme.prime.eval</code> application:</p>

<pre class="shell"><code>$ ./gradlew export.com.acme.prime.eval
:com.acme.prime.hello.provider:compileJava
:com.acme.prime.hello.provider:processResources UP-TO-DATE
:com.acme.prime.hello.provider:classes
:com.acme.prime.hello.provider:jar
Warning: Please update this Bundle-Description in com.acme.prime.hello.provider/bnd.bnd
:com.acme.prime.hello.provider:assemble
:com.acme.prime.hello.provider:export.hello
Plugin found aQute.launcher.plugin.ProjectLauncherImpl 1.4.0.201406101507

BUILD SUCCESSFUL
</code></pre>

<p>This task will store the output in <code>com.acme.prime.hello.provider/generated/distributions/com.acme.prime.eval.jar</code>.</p>

<h2 id="putting-it-on-github">Putting it on Github</h2>

<p>We should now create a repository on Github, for which you will need an account. There is a nice tutorial about <a href="https://help.github.com/articles/create-a-repo/">setting up new repositories on Github</a> but we take it here one by one.</p>

<p>Lets call this new repository the same as the workspace <code>com.acme.prime</code>. So go to your home page and click on te <code>+</code> on the top and select <code>New Repository</code>.</p>

<p><img src="/img/tutorial_base/ci-github-0.png" alt="Create new repo" /></p>

<p>This will open the window where we can define our repository information. Be nice, also add a description …</p>

<p><img src="/img/tutorial_base/ci-github-1.png" alt="Create new repo" /></p>

<p>We then click on <code>Create Repository</code> which brings us on a page that explains how to connect our local repository in <code>~/git/com.acme.prime.eval</code> to this repository on Github. In our case, we want to connect a brand new repository, even though our current Git workspace is still connected to the OSGi <code>workspace</code> repository, and it is highly unlikely you can write that repository.</p>

<p><img src="/img/tutorial_base/ci-github-2.png" alt="Create new repo" /></p>

<p>We will follow the first scenario but we want to use the SSH URI, so click on the <code>SSH</code> button and copy the URI in the adjoining text box to the clipboard. It should be something like:</p>

<blockquote>
  <p><code>git@github.com:&lt;you&gt;/com.acme.prime.git</code></p>
</blockquote>

<p>This URL will of course differ for you. </p>

<p>Now, in bndtools we must connect our bnd workspace to this repository. It should theoretically be possible to do this inside Eclipse with EGit but this was trickier than expected. So we will take it from the command line. EGit is just not yet up to the level of the original legendary CVS plugin in Eclipse and this turned to be quite cumbersome.</p>

<p>So we will reconnect form the shell. First we delete the old repo since it contains the history of the archetype which is of no importance to us.</p>

<pre class="shell"><code>$ cd ~/git/com.acme.prime
(master)$ rm -rf .git
$
</code></pre>

<p>Then we basically do what Github told us to do on the start page of our repository …</p>

<pre class="shell"><code>$ git init
(master)$ git add .
(master)$ git commit -m "first commit"
(master)$ git remote add origin git@github.com:&lt;you&gt;/com.acme.prime.git
(master)$ git push -u origin master
Counting objects: 98, done.
Delta compression using up to 8 threads.
Compressing objects: 100% (60/60), done.
Writing objects: 100% (98/98), 66.13 KiB | 0 bytes/s, done.
Total 98 (delta 8), reused 0 (delta 0)
To git@github.com:&lt;you&gt;/com.acme.prime.git
 * [new branch]      master -&gt; master
Branch master set up to track remote branch master from origin.
(master)$
</code></pre>

<p>Sometimes command line interfaces are hard to beat … If you go to <a href="https:/github.com">Github</a> then you should be able to see your workspace now.</p>

<p><img src="/img/tutorial_base/ci-github-3.png" alt="Create new repo" /></p>

<p>Future changes can now be pushed from the command line (<code>git push</code>) or from inside Eclipse with <code>@/Team</code></p>

<h2 id="continuous-integration">Continuous Integration</h2>

<p>The bnd workspace is setup to be built continuously with [Travis CI][3]. The way to activate this is ridiculously simple. Just go to the <a href="https://travis-ci.org/">Travis site</a>, create an account based on your Github credentials, and go to the your account page. This is so simple that we will not explain this in detail.</p>

<p>Once your logged in, click on your icon and/or name and select accounts. Select the <code>Repositories</code> tab. The first time it is likely that you need to click on the <code>Sync Now</code> button, this refreshes your list of repositories. Find your new repository and set the right button to <code>ON</code>, that’s it. Now every push will automatically build the repository.</p>

<p><img src="/img/tutorial_base/ci-travis-1.png" alt="Create new repo" /></p>

<p>Travis will not kick off a build when you switch on the repository. To kick it off we need to make a change and commit that change to Github. Github and Travis are buddies so that this push will result in a build.</p>

<p>Ok, lets add some description in the manifest for our <code>com.acme.prime.eval.provider</code> bundle. Double click the <code>bnd.bnd</code> file in that project, and select the <code>Source</code> tab. (Although there is a <code>Description</code> tab with real widgets we find the <code>Source</code> tab easier to use for these things.) </p>

<pre><code>Bundle-Version:					1.0.0.${tstamp}
Bundle-Description: 				\
	A bundle with a provider. Notice that this provider exports the API package. \
	It also provides a JUnit test and it can be run standalone. \
	\
	${warning;Please update this Bundle-Description in com.acme.prime.eval.provider/bnd.bnd}
</code></pre>

<p>The version is ok, the description could use some improvement. We should also remove the warning once we added a proper description:</p>

<pre><code>Bundle-Description: 				\
	They told me to change the manifest so I did.
</code></pre>

<p>Save it, select the <code>bnd.bnd</code> file and then <code>@/Team/Commit</code>. This will pop up the following dialog:</p>

<p><img src="/img/tutorial_base/ci-travis-2.png" alt="Create new repo" /></p>

<p>Click on <code>Commit and Push</code>, this will commit the changes and push the changes to the repo. Github will call Travis and then Travis will start building.</p>

<p class="bug">EGit repeatedly hang but the server was ok. If EGit indicates 100% then your changes are on Github.</p>

<p>It might take a few minutes, but after some time your home screen on Travis should show the build of the <code>com.acme.prime</code> workspace.</p>

<p><img src="/img/tutorial_base/ci-travis-3.png" alt="Create new repo" /></p>

<h2 id="how-does-it-work">How Does it Work?</h2>

<p>Continuous integration is not a new development; our first Continuous Integration (CI) server was setup in 1994. However, maintaining a CI server was often a pain in the ass. Jenkins/Hudson improved on the situation but always felt a bit uneasy feeling why we needed a build tool, that is supposed to customize our build environments, <em>and</em> a CI server tool with its own cumbersome plugin model? Debugging those CI server setups was sometimes quite an endurance. Travis showed us how easy it can be to maintain a CI server when you can properly build your workspace. Now, most testing of the build can be done on the laptop with the confidence that the CI will act the same.</p>

<p>So to repeat the steps. We use Github to store the workspace. This is easy to manage from Eclipse with EGit or from the command line. A push to Github will send all changes to Github. Once everything is there, Github posts a URL to Travis and travis will build. If the build fails, you will get a notification.</p>


				</div>
				<hr/>
				<a class=nav-prev href="700-deploy.html" >Prev</a>
				<a class=nav-next href="/book/220-tutorial-base.html#End" >Next</a> 

			</div>
	</ul>

	
<nav class=next-prev>
	<a href=''></a> <a href='/book/220-tutorial-base.html#End'></a>
</nav>
<footer class="container12" style="border-top: 1px solid black;padding:10px 0">
	<ul span=12 row>
		<li span=3>
			<ul>
				<li><a href="/contact.html">Contact</a>
			</ul>
		<li span=3>
			<ul>
				<li><a href="">Developers</a>
			</ul>
		<li span=4>
			<ul>
				<li><a href="">More</a>
			</ul>
		<li span=2>
			<a href="http://www.osgi.org"><img style="float:right;width:8em" src="/img/osgi-logo-256.png"></a>
	</ul>
</footer>

</body>
</html>
